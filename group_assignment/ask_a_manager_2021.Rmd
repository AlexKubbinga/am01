---
title: "Ask A Manager 2021"
author: "Group 5 MAM"
date: "2021-09-16"
output: html_document
---

```{r load-libraries, echo=FALSE, warning=FALSE}
library(tidyverse)
library(janitor) 
library(skimr)
library(countrycode) # to clean up country names
library(broom)
library(car)
library(ggfortify)
```


```{r}
# load "Ask a A Manager 2021 Survey" googlesheet
# https://www.askamanager.org/
ask_a_manager_2021 <- read_csv(here("data","ask_a_manager.csv"))

skimr::skim(ask_a_manager_2021)

```

# Data cleaning (exchange rate: Alex)

remove missing values.

```{r remove-na}
# remove the NA values
ask_a_manager_2021 <- ask_a_manager_2021 %>% 
  filter(!gender %in% c("NA","Other or prefer not to answer","Prefer not to answer") &
           race!="NA" &
           highest_level_of_education_completed!="NA")
```

transform into ordered `factor` datatype

```{r, warning=FALSE}
ask_a_manager_2021 <- ask_a_manager_2021 %>% 
  mutate(
    country = countrycode::countryname(country),
    how_old_are_you = factor(how_old_are_you,levels=c("under 18","18-24","25-34","35-44","45-54","55-64","65 or over")),
    years_of_experience_in_field = factor(years_of_experience_in_field,levels=c("1 year or less","2 - 4 years","5-7 years","8 - 10 years","11 - 20 years","21 - 30 years","31 - 40 years","41 years or more")),
    overall_years_of_professional_experience = factor(overall_years_of_professional_experience,levels=c("1 year or less","2 - 4 years","5-7 years","8 - 10 years","11 - 20 years","21 - 30 years","31 - 40 years","41 years or more")),
    highest_level_of_education_completed = factor(highest_level_of_education_completed, labels=c("High School","Some college","College degree","Master's degree","Professional degree (MD, JD, etc.)","PhD")),
    log_annual_salary = log(annual_salary)
  ) %>% 
  janitor::clean_names() # clean columns names
```

only keep top 25 industries.

```{r}
# Industry is messy... it has > 1000 different industries.
# we only take top 25 industries into our analytics. (24597(92%) out of 26765 entries)
industry_list <- ask_a_manager_2021 %>% 
  count(industry, sort=TRUE) %>% 
  mutate(percent = 100* n/sum(n)) %>% 
  slice_max(order_by = n, n = 25) %>% 
  select(industry)
ask_a_manager_2021 <- ask_a_manager_2021 %>% 
  filter(industry %in% industry_list$industry)

```

only keep the commonly used currencies and standardize the number

```{r}
# transform all the currencies into USD and only keep the commonly used currencies
# todo (Alex)
ask_a_manager_2021 <- ask_a_manager_2021 %>% 
  filter(industry %in% industry_list$industry &
           currency=="USD" &
           !is.na(country))

# filter out outliers of annual salary
# regression for both datasets
# ask_a_manager_2021 <- ask_a_manager_2021 %>% 
#   filter(annual_salary>1000 & annual_salary<1000000)
# todo

```

```{r}
colnames(ask_a_manager_2021)
```




# Exploratory Data Analysis

## Counts

```{r}
# Some quick counts, groups, etc
ask_a_manager_2021 %>% 
  count(how_old_are_you, sort=TRUE) %>% 
  mutate(percent = 100* n/sum(n))

# 'country' 
ask_a_manager_2021 %>% 
  count(country, sort=TRUE) %>% 
  mutate(percent = 100* n/sum(n))

# 'city' 
ask_a_manager_2021 %>% 
  count(city, sort=TRUE) %>% 
  mutate(percent = 100* n/sum(n))

# highest_level_of_education_completed 
ask_a_manager_2021 %>% 
  count(highest_level_of_education_completed) %>% 
  mutate(percent = 100* n/sum(n))%>% 
  arrange(desc(percent))

# gender
ask_a_manager_2021 %>% 
  count(gender) %>% 
  mutate(percent = 100* n/sum(n))%>% 
  arrange(desc(percent))

# race
ask_a_manager_2021 %>% 
  count(race) %>% 
  mutate(percent = 100* n/sum(n))%>% 
  arrange(desc(percent))

# overall_years_of_professional_experience 
ask_a_manager_2021 %>% 
  count(overall_years_of_professional_experience ) %>% 
  mutate(percent = 100* n/sum(n))%>% 
  arrange(desc(percent))

# years_of_experience_in_field  
ask_a_manager_2021 %>% 
  count(years_of_experience_in_field  ) %>% 
  mutate(percent = 100* n/sum(n))%>% 
  arrange(desc(percent))

```

## Salary (Yuan)

How is salary distributed?

```{r}

# How is salary distributed?
favstats(ask_a_manager_2021$annual_salary) # find a really rich guy here

ask_a_manager_2021 %>% 
  slice_min(order_by = annual_salary,n =nrow(ask_a_manager_2021)-5) %>% # choose a number
  ggplot(aes(x=annual_salary))+
  geom_boxplot()

ask_a_manager_2021 %>% 
  slice_min(order_by = annual_salary,n =nrow(ask_a_manager_2021)-5) %>% # choose a number
  ggplot(aes(x=annual_salary))+
  stat_ecdf()

# taking log is better
ggplot(ask_a_manager_2021, aes(x=log(annual_salary)))+
  geom_density()

```

right skewed distribution. 

## Industry (Yuan)

## Gender vs Industry (Yuan)

## Education (Jean)


## Race (Clara)
```{r}
ask_a_manager_2021 %>% 
  group_by(race) %>% 
  filter(n() > 500) %>% 
  summarise(count=n()) %>% 
  ggplot(aes(y=count, x=race, color=race))+
  geom_col() +
  theme(legend.position = "none") +
  labs(x="Race", y="Count", title="Count by Race", subtitle = "Races with > 500 Respondents")+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) + 
  NULL
```

### Race and Mean Salary 
```{r}
ask_a_manager_2021 %>% 
  group_by(race) %>% 
  filter(n() > 500) %>% 
  summarise(annual_average_delta = mean(delta, na.rm=TRUE)) %>% 
  ggplot(aes(y=mean, x=race, color=race))+
  geom_col() +
  theme(legend.position = "none") +
  labs(x="Race", y="Count", title="Count by Race", subtitle = "Races with > 500 Respondents")+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) + 
  NULL
```


## Location (Alex)

> MAP

```{r}
# Count by Industry

ask_a_manager_2021 %>% 
  group_by(industry) %>% 
  summarise(count=n()) %>% 
  ggplot(aes(y=fct_reorder(industry,count),x=count))+
  geom_col()

# null hypothesis: no difference between
```

## Age (Raina)


## Experience (Raghav)


# Statistical Tests


## Gender vs Salary (Clara)

```{r}
ask_a_manager_2021 %>% 
  ggplot(aes(x=gender,y=log_annual_salary))+
  geom_boxplot()
```

```{r}
ask_a_manager_2021 <- ask_a_manager_2021 %>%
  filter(gender!="Non-binary")
t.test(annual_salary ~ gender, data = ask_a_manager_2021)
```



## Gender vs Education (Jean)

## Race vs Salary (Raina)

> wisely choose the race. like white vs. not white

## Race vs Education (Jean)

## Changed Industry? vs salary (Raghav)



```{r}
colnames(ask_a_manager_2021)
```



# Regression Analysis (Yuan)

